## Electricity Prices — Early Next‑Day Forecast (SE3)

Course project for **KTH ID2223 Scalable Machine Learning**.

### Live dashboard
`https://jeppcode.github.io/Electricity-Price-Forecast/`

### 0) Project name and group members
- **Project**: Electricity Prices — Early Next‑Day Forecast
- **Group members**: Jesper Malmgren, Niklas Dahlbom

### 1) Dynamic data sources
This project uses live/public APIs:
- **Electricity prices**: `elprisetjustnu.se` (day-ahead hourly prices for SE1–SE4).  
  API docs: `https://www.elprisetjustnu.se/elpris-api`
  - Note: from Oct 2025, the API may return **15-minute** prices (96/day).
  - We use a proxy endpoint (`api.elpris.eu`) when available to keep hourly resolution, and we aggregate to hourly when sub-hour data is returned.
- **Weather**: **Open‑Meteo** hourly forecast + historical weather.  
  `https://open-meteo.com/`

### 2) Prediction problem
Predict **tomorrow’s hourly electricity prices** for **SE3 (Stockholm)** before the official day‑ahead prices are published (typically **~13:00** the day before).

This supports early planning for flexible consumption (EV charging, laundry, dishwasher, heat pumps).

### 3) UI to show the value
The UI is a static GitHub Pages dashboard (served from `docs/`) that updates automatically:
- **Cheapest hours** / **most expensive hours**
- **Cheapest 4-hour window** (lowest average across any 4 consecutive hours)
- Estimated savings for shifting a flexible load (kWh)
- Plots: tomorrow hourly predictions, predicted vs actual history, feature importance

### 4) Technologies used
- **Python** (feature pipeline, training, inference)
- **Hopsworks Feature Store** (feature groups + feature views) and **Model Registry**
- **XGBoost** regression model
- **GitHub Actions** (daily ingest + daily inference + monthly retraining)
- **GitHub Pages** (static dashboard)

## Repository structure
- `NotebooksElectricity/1_electricity_prices_backfill.ipynb`: backfill + create feature groups (versioned)
- `NotebooksElectricity/2_electricity_prices_feature_pipeline.ipynb`: daily feature ingestion (writes to offline + online)
- `NotebooksElectricity/3_electricity_prices_training_pipeline.ipynb`: monthly training + model registry
- `NotebooksElectricity/4_electricity_prices_batch_inference.ipynb`: daily inference + dashboard assets (images + JSON)
- `src/util.py`: API clients + shared helpers
- `docs/`: GitHub Pages dashboard

## Automation (GitHub Actions)
Workflow: `.github/workflows/electricity-prices-daily.yml`
- **Daily**:
  - Runs Notebook 2 (feature ingestion)
  - Runs Notebook 4 (batch inference + dashboard assets)
  - Commits updated dashboard assets under:
    - `docs/PricesDashboard/assets/img/` (PNG plots)
    - `docs/PricesDashboard/assets/data/forecast_summary.json` (small JSON summary used by `docs/index.md`)
- **Monthly**: runs Notebook 3 (training + model registry)

## Running locally
1) Create a virtualenv and install dependencies:

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
pip install papermill
```

2) Configure secrets/env:
- For local runs, create a `.env` in the repo root with your Hopsworks config (or rely on GitHub secrets in Actions).

3) Run notebooks (example):

```bash
python -m papermill NotebooksElectricity/2_electricity_prices_feature_pipeline.ipynb /tmp/out2.ipynb
python -m papermill NotebooksElectricity/4_electricity_prices_batch_inference.ipynb /tmp/out4.ipynb
```

## Dashboard
GitHub Pages serves the site from `docs/`.

The dashboard is plot-driven (PNG images) and also reads a small JSON summary generated by Notebook 4:
- `docs/PricesDashboard/assets/data/forecast_summary.json`
